# ==============================================================================
# Takumi Security Gatekeeper - Tinyproxy Configuration
# ==============================================================================

# --- 1. Process Management ---
User           nobody
Group          nogroup
Port           8888
PidFile        "/tmp/tinyproxy.pid"

# --- 2. Connection Handling ---
# [Note] Extended timeout for large model downloads (AI specific)
Timeout        600
MaxClients     100
MinSpareServers 5
MaxSpareServers 20
StartServers   10

# --- 3. Logging & Monitoring ---
# [Note] Log to a temporary file to avoid permission issues in Rootless Docker
LogFile "/tmp/tinyproxy.log"
LogLevel       Connect
StatFile       "/usr/share/tinyproxy/stats.html"
DefaultErrorFile "/usr/share/tinyproxy/default.html"

# --- 4. Privacy & Anonymity ---
# [Security] Hide the proxy signature from target servers
DisableViaHeader Yes
# [Security] Do not include the client IP in headers
XTinyproxy     No

# --- 5. Access Control (ACL) ---
# [Security] Allow connections only from Docker internal networks
# Localhost
Allow          127.0.0.1
# Docker Default Bridge
Allow          172.16.0.0/12
# Home/Office Local Networks
Allow          192.168.0.0/16
# Docker Custom Networks (Compose)
Allow          10.0.0.0/8

# --- 6. Security Filters (Future Use) ---
# [Security] Restrict CONNECT method to HTTPS ports only
ConnectPort    443
ConnectPort    563

# [Security] Domain Whitelisting
Filter         "/etc/tinyproxy/allow.list"
FilterURLs     On
FilterExtended On
FilterCaseSensitive Off
FilterDefaultDeny Yes